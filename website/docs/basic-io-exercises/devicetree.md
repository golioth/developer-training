---
sidebar_position: 2
---

# Zephyr Devicetree

Zephyr uses devicetree bindings to associate pins, peripherals, and external hardware with an abstract definition in your code.

It won't take long for you to appreciate the power of this approach. If for some reason you need to change which pins are being used for a project, or you need to update the type of sensor you are using, it can be as easy as changing a few lines in your devicetree overlay file, and leaving your C code completely untouched.

## DTS and Overlays

All devices that are supported in Zephyr have a devicetree source (DTS) included in the codebase. These files provide all of the hardware details Zephyr needs to interact with them&ndash;memory layout, clock speed, register addresses for peripherals for everything from GPIO to i2c, and more. These files are great for you to reference, but you will not edit them directly unless you are adding your own board/chip that lacks official support. Do you need to know the clock speed and TX/RX pins used by the Espressif Saola dev board? Look in the DTS file:

```js title="excerpt from: golioth-zephyr-workspace/zephyr/boards/xtensa/esp32s2_saola/esp32s2_saola.dts"
&cpu0 {
	clock-frequency = <ESP32_CLK_CPU_240M>;
};

&uart0 {
	status = "okay";
	current-speed = <115200>;
	tx-pin = <43>;
	rx-pin = <44>;
};
```

Each project can specify one or more devicetree overlay files. This is where your application code will declare its intention to use pins and peripherals. For instance, the MagTag sample code turns on an i2c bus and selects the pins that are connected to the accelerometer.

```js title="MagTag accelerometer excerpt from: magtag-demo/boards/esp32s2_saola.overlay"
&i2c1 {
	sda-pin = <33>;
	scl-pin = <34>;
	status = "okay";

	lis3dh@19 {
			compatible = "st,lis2dh";
			reg = <0x19>;
			label = "LIS3DH";
	};
};
```

All devicetree files are merged together a build time. Anything your overlay files change will be incorporated with inherited settings from the board and/or chip DTS files. Notice that a lot of properties from the chip's `esp32s2.dtsi` file have joined the i2c settings we saw in the overlay file:

```js title="excerpt from file generated by build process: magtag-demo/build/zephyr/zephyr.dts"
i2c1: i2c@3f427000 {
	compatible = "espressif,esp32-i2c";
	#address-cells = < 0x1 >;
	#size-cells = < 0x0 >;
	reg = < 0x3f427000 0x1000 >;
	interrupts = < 0x35 >;
	interrupt-parent = < &intc >;
	label = "I2C_1";
	clocks = < &rtc 0x5 >;
	status = "okay";
	clock-frequency = < 0x186a0 >;
	sda-pin = < 0x21 >;
	scl-pin = < 0x22 >;
	lis3dh@19 {
		compatible = "st,lis2dh";
		reg = < 0x19 >;
		label = "LIS3DH";
	};
};
```

Now if you were to use a different variant of the chip, the devicetree would pull in the correct register address and other settings for the new part without anything more than a build command change from you. You would just need to verify the pin mappings for your overlay files work with the new chip flavor.

## Some devicetree resources to keep in mind

Today's training will guide you through your first small steps in using devicetree. As you advance, consider reading through [the Zephyr devicetree docs](https://docs.zephyrproject.org/latest/build/dts/intro.html). We also recommend watching this talk from Marti Bolivar at the 2021 Zephyr Developer's Summit that [walks through the core devicetree concepts](https://www.youtube.com/watch?v=sWaxQyIgEBY).
